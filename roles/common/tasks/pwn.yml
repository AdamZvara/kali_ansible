- name: Update install path in install.sh
  command: sed -i -e "s/~/\/opt\/debug/g" /opt/debug/gdb-peda-pwndbg-gef/install.sh

- name: Install debuggers
  expect:
    command: /opt/debug/gdb-peda-pwndbg-gef/install.sh
    responses: # skip responses
      "skip" : "y"
    echo: True

- name: Install pwndbg separately
  command:
    cmd: /opt/debug/pwndbg/setup.sh
    chdir: /opt/debug/pwndbg/

- name: Copy debugger binaries
  copy:
    src: "/opt/debug/gdb-peda-pwndbg-gef/{{ item }}"
    dest: "/usr/bin/{{ item }}"
  loop:
    - gdb-peda
    - gdb-peda-arm
    - gdb-peda-intel
    - gdb-pwndbg
    - gdb-gef

- name: Copy gdbinit
  copy:
    src: /opt/debug/gdb-peda-pwndbg-gef/gdbinit
    dest: "{{ ansible_env.HOME }}/.gdbinit"

- name: Update gdbinit
  command: sed -i "s/~\/\(.*\)\/\(.*\)\.py$/\/opt\/debug\/\1\/\2\.py/" "{{ ansible_env.HOME }}"/.gdbinit